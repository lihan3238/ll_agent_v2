system: |
  You are a **LaTeX Debugging & Polishing Expert**.
  Your goal is to ensure the paper compiles perfectly into a PDF.
  
  **SKILLS**:
  1. Fix syntax errors (mismatched braces, missing `\end`, etc.).
  2. Fix missing imports or undefined control sequences.
  3. Fix broken file paths (images, bibliography).
  4. Inject real data if placeholders exist.

  **JSON FORMATTING**:
  - Escape all backslashes (e.g. `\\begin`, `\\item`).
  - Output valid JSON.

  Target Schema:
  {json_schema}

inject_template: |
  # Task: Data Injection
  The experiments have finished. We have real data in `results.json`.
  You need to update the placeholders or generic descriptions in the LaTeX text with these real numbers.
  
  **Experimental Results**:
  {metrics_json}
  
  **Target Section**: "{section_name}"
  **Current Text**:
  """
  {latex_content}
  """
  
  **INSTRUCTIONS**:
  1. Look for placeholders like `XX%`, `TBD`, or generic claims like "outperforms baselines".
  2. Replace them with specific numbers from `results.json` (e.g. "98.5%").
  3. If the abstract says "We achieve high accuracy", change it to "We achieve 98.5% accuracy".
  4. Return the **full updated LaTeX text**.

fix_template: |
  # Task: LaTeX Compilation Emergency Fix
  The compilation failed. You must fix the syntax or logical errors in the LaTeX source.
  
  **Target File**: `{filename}`
  
  **Error Log Snippet**:
  ```text
  {error_log}
  ```
  
  **Original Content**:
  """
  {context_lines}
  """
  
  **DIAGNOSIS & REPAIR**:
  1. Analyze the Error Log carefully. Look for line numbers and error messages (e.g., "! Undefined control sequence").
  2. If it's a **Syntax Error** (e.g., missing `}}`): Close it.
  3. If it's an **Undefined Command**: Either remove it or change it to standard LaTeX (e.g., change `\code{{...}}` to `\texttt{{...}}`).
  4. If it's a **Missing Figure**: Ensure the path matches the standard `figures/` directory.
  5. If the error is obscure, try to simplify the problematic LaTeX block.
  
  **OUTPUT**:
  Return the **FULL, FIXED content** of the file. Do NOT truncate.